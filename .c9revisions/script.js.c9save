{"ts":1370259809011,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var apiKey = '0a6b68796bfcfe694987a9ddf3eddd1b735dcd7f';\nvar urlBase = 'http://api.census.gov/data/2011/acs5';\nvar current = $('#whichValue').val();\nvar params = {\n\t\"for\":'county:*',\n\t\"in\":'state:*',\n\t\"key\":apiKey,\n\t\"get\":$('#whichValue option:selected').data('get')\n}\ntransforms = {\n  \"Mean Commute\": function(a) {\n    var b = [];\n    var ct,i;\n    for (i = 0; i < a.length; i++) {\n      ct = [parseFloat(a[i][0]) / parseFloat(a[i][1]), a[i][2], a[i][3]];\n      if (!ct[0]) {\n        ct[0] = 0;\n      }\n      b.push(ct);\n    }\n    return b;\n  },\n  \"Income Car Vs Trans\": function(a) {\n    var b = [],i,ct;\n    for (i = 0; i < a.length; i++) {\n      ct = [parseFloat(a[i][0]) - parseFloat(a[i][1]), a[i][2], a[i][3]];\n      if (!ct[0]) {\n        ct[0] = 0;\n      }\n      b.push(ct);\n    }\n    return b;\n  },\n};\n$('#whichValue').on('change',function(){\n\tcurrent = $('#whichValue').val();\n\t$.get(urlBase,{\n\t\"key\":apiKey,\n\t\"get\":$('#whichValue option:selected').data('get'),\n\t\"for\":'county:*',\n\t\"in\":'state:*'\n},'json').then(function(a){\nvar metric = $('#whichValue option:selected').val();\n  transform = transforms[metric];\n  if (transform) {\n   buildValues(data, transform(a));\n  }else{\n\tbuildValues(data, a);\n\t}\n\tshowAll();\n})\n});\nvar m = L.map('map');\n//if(!location.hash){\n\tm.setView([42.076,-71.505], 8)\n//};\n\nvar url = 'http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpeg';\n\nvar attributionText = 'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\n\nvar mapquestSubdomains = '1234';\n\nvar optionsObject = {\n\tattribution : attributionText,\n\tsubdomains : mapquestSubdomains\n}\n\nvar mq=L.tileLayer(url, optionsObject).addTo(m);\nvar watercolor = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg',{attribution:'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'});\nvar data;\nvar rt = rTree();\nvar obj={};\nvar scale = d3.scale.quantile();\nscale.range(d3.range(11));\nvar layerControl = L.control.layers({\"Stamen Watercolor\":watercolor,\"Map Quest Open\":mq}).addTo(m);\nvar counties = L.geoJson({features:[]},{\n\tonEachFeature:function (f,l){\n\tvar out = [];\n\tif (f.properties){\n\t\tfor(key in f.properties){\n\t\t\tout.push(key+\": \"+f.properties[key]);\n\t\t}\n\t\tif(obj[f.id]){\n\t\t\tout.push(current+': '+obj[f.id].toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\"))\n\t\t}\n\t\tl.bindPopup(out.join(\"<br />\"));\n\t}\n\t},style:function(f){\n\t\t\treturn {fillColor:colorbrewer.RdYlBu[11][scale(obj[f.id])],weight:0,fillOpacity:0.8}\n\t\t\n\t}\n}).addTo(m);\nfunction buildValues (data, rows){\nvar vals = [];\n\tif(rows[0].length===4){\n\t\t_.each(rows,function(r){\n\t\t\tvar val = parseFloat(r[0],10);\n\t\t\tobj[r[2]+r[3]]=val;\n\t\t\tvals.push(val);\n\t\t});\n\t}else if(rows[0].length===3){\n\t\t_.each(rows,function(r){\n\t\tvar val = parseFloat(r[0],10);\n\t\t\tobj[r[1]+r[2]]=val;\n\t\t\tvals.push(val);\n\t\t});\n\t}\n\tscale.domain(vals);\n}\n\tlayerControl.addOverlay(counties,\"Counties\");\n//m.addHash({lc:layerControl});\n$.when($.ajax('json/us-counties.json'),$.get(urlBase,params,'json')).then(function(a,b){\n\tdata = a[0];\n\tvar rows = b[0];\n\tbuildValues (data, rows)\n\t\n\trt.geoJSON(data,function(err,success){\n\t\tif(!err){\n\t\t\tshowAll();\n\t\t}\n\t});\n});\n\nm.on(\"contextmenu moveend\",showAll);\nfunction showAll(){\n\tcounties.clearLayers();\n\tvar bounds = m.getBounds();\n\tcounties.addData(\n\t\trt.bbox(\n\t\t\t[\n\t\t\t\t[bounds.getSouthWest().lng,bounds.getSouthWest().lat],\n\t\t\t\t[bounds.getNorthEast().lng,bounds.getNorthEast().lat]\n\t\t\t]\n\t\t)\n\t);\n}\n\n"]],"start1":0,"start2":0,"length1":0,"length2":3735}]],"length":3735}
{"contributors":[],"silentsave":false,"ts":1370260989992,"patch":[[{"diffs":[[0,"var ct,i"],[1,",len"],[0,";\n    fo"]],"start1":336,"start2":336,"length1":16,"length2":20},{"diffs":[[0,"  for (i = 0"],[1,",len=a.length"],[0,"; i < "],[-1,"a."],[0,"len"],[-1,"gth"],[0,"; i++) {\n   "]],"start1":352,"start2":352,"length1":38,"length2":46},{"diffs":[[0," [],i,ct"],[1,",len"],[0,";\n    fo"]],"start1":609,"start2":609,"length1":16,"length2":20},{"diffs":[[0," = 0"],[1,",len=a.length"],[0,"; i < "],[-1,"a."],[0,"len"],[-1,"gth"],[0,"; i+"]],"start1":633,"start2":633,"length1":22,"length2":30}]],"length":3759,"saved":false}
{"ts":1370261028159,"patch":[[{"diffs":[[0,"[3]];\n      "],[-1,"if (!ct[0]) {"],[0,"\n        ct["]],"start1":463,"start2":463,"length1":37,"length2":24},{"diffs":[[0,"        ct[0] = "],[1,"ct[0]|"],[0,"0;\n      }\n     "]],"start1":476,"start2":476,"length1":32,"length2":38},{"diffs":[[0," ct[0]|0;\n      "],[-1,"}"],[0,"\n      b.push(ct"]],"start1":491,"start2":491,"length1":33,"length2":32},{"diffs":[[0,"    "],[-1,"if (!ct[0]) {\n        ct[0] = 0;\n      }"],[1,"ct[0] = ct[0]|0;"],[0,"\n   "]],"start1":736,"start2":736,"length1":48,"length2":24}]],"length":3727,"saved":false}
{"ts":1370261144077,"patch":[[{"diffs":[[0,"ta, a);\n"],[-1,"\t"],[0,"}\n\tshowA"]],"start1":1193,"start2":1193,"length1":17,"length2":16},{"diffs":[[0,"ll();\n})"],[1,";"],[0,"\n});\nvar"]],"start1":1209,"start2":1209,"length1":16,"length2":17}]],"length":3727,"saved":false}
